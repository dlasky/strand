<script>
/**
 * @license
 * Copyright (c) 2015 MediaMath Inc. All rights reserved.
 * This code may only be used under the BSD style license found at http://mediamath.github.io/strand/LICENSE.txt

*/
(function (scope) {

	var PolymerPatch = {	

		_polymerPatched : false,
		
		_patch: function() {

			Polymer.Base._createObservedProperty = function (property, methodName) {
				this._addPropertyEffect(property, Polymer.Base.PROPERTY_EFFECT_TYPES.OBSERVE, {
					fn: runObserverEffectPatched,
					info: {
						strictlyMatchProperty: property,
						methodName: methodName
					}
				});
			};
			
			function runObserverEffectPatched (inst, property, value, old, info) {
				let fn = inst[info.methodName];
				if (fn) {
					if (info.strictlyMatchProperty === property) {
						fn.call(inst, value, old);
					}
				} else {
					console.warn('observer method `' + info.methodName + '` not defined');
				}
			}
			
			this._polymerPatched = true;
		}
	};

	if (window.Polymer && !PolymerPatch._polymerPatched) {
		PolymerPatch._patch();
	}

	window.addEventListener('WebComponentsReady', function(e) {
		if (window.Polymer && !PolymerPatch._polymerPatched) {
			PolymerPatch._patch();
		}
		console.log('polymer patched : ', PolymerPatch._polymerPatched);
	});

	scope.PolymerPatch = PolymerPatch;
})(window.StrandLib = window.StrandLib || {});
</script>
